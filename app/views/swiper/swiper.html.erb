<!-- Slider main container -->
<div class='row'>
  <div class='col-md-12'>
    <div class="swiper-container">
      <!-- Additional required wrapper -->
      <div class="swiper-wrapper">
        <!-- Slides -->
        <%= render 'artworks/art_card_ui', artwork: @artworks.second %>
        <%= render 'artworks/art_card_ui', artwork: @artworks.first %>
        <%= render 'artworks/art_card_ui', artwork: @artworks.third %>

      </div>
    </div>
  </div>
</div>

<script>

  slideArray = [];
  <% @artworks[3..-1].each do |artwork| %>
  slideArray.push($('<%= escape_javascript( render 'artworks/art_card_ui', artwork: artwork)%>'));
  <% end %>


  // TODO better to embed artcard in a form to deal with
  // pesky authenticity token issue...
  var mySwiper = new Swiper('.swiper-container', {
    // Optional parameters

    // Navigation arrows
    nextButton: '.swiper-button-next',
    prevButton: '.swiper-button-prev',

    centeredSlides: true,
    initialSlide: 1,
    runCallbacksOnInit: false,

    on: {
      slideNextTransitionStart: downVote,
      slidePrevTransitionStart: upVote,
      slideNextTransitionEnd: loadNextSlides,
      slidePrevTransitionEnd: loadNextSlides,
    }
  });

  function upVote() {
    var slide = this.slides[this.previousIndex];
    $(slide).find('.swiper-upvote-link')[0].click();
  }

  function downVote() {
    var slide = this.slides[this.previousIndex];
    $(slide).find('.swiper-downvote-link')[0].click();
  }

  function loadNextSlides() {
    if (this.activeIndex == 0) {
      this.removeSlide(1);
      this.prependSlide(slideArray.pop());
    } else if (this.activeIndex == 2) {
      this.removeSlide(1);
      this.appendSlide(slideArray.pop());
    }
    this.update();
  }


  $(document).keydown(function (e) {
    switch (e.which) {
      // left
      case 37:
        mySwiper.slideNext();
        break;
      // right
      case 39:
        mySwiper.slidePrev();
        break;
    }
  });


</script>